<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MaziTM</title>
    <style>
        /* --- PREMIUM CSS --- */
        :root {
            --primary: #f97316; /* Orange */
            --accent: #0ea5e9; /* Sky Blue */
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #94a3b8;
            --border: #e2e8f0;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg); color: var(--text);
            height: 100vh; display: flex; flex-direction: column;
            user-select: none;
        }

        /* ICONS */
        .icon { width: 24px; height: 24px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

        /* HEADER */
        header {
            height: 60px; background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; position: fixed; top: 0; width: 100%; z-index: 100;
        }
        .logo-box {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, var(--primary), #ea580c);
            border-radius: 8px; color: white;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 18px;
        }
        .brand { font-size: 20px; font-weight: 800; margin-left: 10px; }
        .brand span { color: var(--accent); font-weight: 300; }
        
        .add-btn {
            width: 36px; height: 36px; background: #0f172a; color: white;
            border-radius: 50%; border: none; font-size: 24px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer;
        }

        /* MAIN */
        main { flex: 1; padding: 80px 16px 80px 16px; overflow-y: auto; }
        .view { display: none; animation: fadeIn 0.3s; }
        .view.active { display: block; }

        /* TASK LIST */
        .task-card {
            background: var(--surface); padding: 16px; border-radius: 12px;
            margin-bottom: 10px; display: flex; align-items: center; gap: 12px;
            border: 1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            position: relative; overflow: hidden;
        }
        .bar { position: absolute; left: 0; top: 0; bottom: 0; width: 5px; background: #ccc; }
        .bar.Work { background: #3b82f6; }
        .bar.Personal { background: #f97316; }
        .bar.Health { background: #ef4444; }
        .bar.Shop { background: #10b981; }

        .checkbox {
            width: 22px; height: 22px; border: 2px solid #cbd5e1; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
        }
        .task-card.done .checkbox { background: var(--accent); border-color: var(--accent); }
        .checkbox svg { display: none; width: 14px; height: 14px; stroke: white; stroke-width: 3; }
        .task-card.done .checkbox svg { display: block; }
        
        .task-card.done h3 { text-decoration: line-through; color: var(--text-light); }
        .task-card.done { opacity: 0.6; }

        .info { flex: 1; }
        .meta { display: flex; gap: 10px; font-size: 10px; font-weight: 800; color: var(--text-light); text-transform: uppercase; margin-bottom: 4px; }
        h3 { margin: 0; font-size: 15px; font-weight: 700; }
        
        .del-btn { background: none; border: none; color: #cbd5e1; padding: 5px; font-size: 18px; }

        /* CALENDAR */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
        .day-head { font-size: 10px; font-weight: bold; color: var(--text-light); margin-bottom: 5px; }
        .day {
            aspect-ratio: 1; background: white; border: 1px solid var(--border); border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 13px; font-weight: bold; position: relative;
        }
        .day.today { background: var(--primary); color: white; border-color: var(--primary); }
        .dot { width: 4px; height: 4px; background: var(--accent); border-radius: 50%; margin-top: 2px; display: none; }
        .day.has-task .dot { display: block; }
        .day.today .dot { background: white; }

        /* TIMER */
        .timer-box { text-align: center; padding-top: 40px; }
        .time-text { font-size: 64px; font-weight: 900; color: var(--text); margin: 20px 0; font-variant-numeric: tabular-nums; }
        .btn-circle {
            width: 64px; height: 64px; border-radius: 50%; border: none;
            display: inline-flex; align-items: center; justify-content: center;
            margin: 0 10px; cursor: pointer; color: white;
        }
        .play { background: var(--primary); box-shadow: 0 8px 20px rgba(249, 115, 22, 0.4); }
        .reset { background: #e2e8f0; color: #64748b; width: 50px; height: 50px; font-size: 20px; }

        /* NAV */
        nav {
            position: fixed; bottom: 0; width: 100%; height: 60px;
            background: var(--surface); border-top: 1px solid var(--border);
            display: flex; justify-content: space-around; align-items: center; z-index: 100;
        }
        .nav-item { border: none; background: none; display: flex; flex-direction: column; align-items: center; color: var(--text-light); font-size: 10px; font-weight: 700; gap: 3px; }
        .nav-item.active { color: var(--primary); }

        /* MODAL */
        #modal, #confirmModal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 200; display: none; align-items: flex-end;
        }
        .sheet { background: white; width: 100%; padding: 20px; border-radius: 20px 20px 0 0; animation: slideUp 0.3s; }
        .label { font-size: 10px; font-weight: bold; color: var(--text-light); margin: 15px 0 5px 0; display: block; }
        input { width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px; }
        
        .chips { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
        .chip {
            padding: 8px 12px; border: 1px solid var(--border); border-radius: 16px;
            font-size: 12px; font-weight: bold; white-space: nowrap; color: var(--text-light);
        }
        .chip.selected { background: var(--primary); color: white; border-color: var(--primary); }
        
        .save-btn { width: 100%; padding: 15px; background: #0f172a; color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; margin-top: 20px; }
        
        /* CONFIRM MODAL */
        .confirm-btn { width: 100%; padding: 15px; margin-top: 10px; border-radius: 12px; font-weight: bold; border: none; font-size: 16px; }
        .btn-yes { background: #ef4444; color: white; }
        .btn-no { background: #e2e8f0; color: #64748b; }

        /* STATS */
        .stat-card { background: white; padding: 20px; border-radius: 20px; border: 1px solid var(--border); text-align: center; }
        .stat-num { font-size: 32px; font-weight: 900; color: var(--primary); }
        .stat-lbl { font-size: 10px; font-weight: 800; color: var(--text-light); text-transform: uppercase; }

        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
        @keyframes slideUp { from {transform:translateY(100%)} to {transform:translateY(0)} }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; align-items:center;">
            <div class="logo-box">M</div>
            <div class="brand">Mazi<span>TM</span></div>
        </div>
        <button class="add-btn" onclick="app.openModal()">
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"></path></svg>
        </button>
    </header>

    <main>
        <!-- TASKS -->
        <div id="view-tasks" class="view active">
            <div id="taskList"></div>
        </div>

        <!-- CALENDAR -->
        <div id="view-cal" class="view">
            <h2 style="margin-top:0">This Month</h2>
            <div class="cal-grid" id="calGrid"></div>
        </div>

        <!-- TIMER -->
        <div id="view-timer" class="view">
            <div class="timer-box">
                <div style="font-size:12px; font-weight:bold; color:#94a3b8;">FOCUS TIMER</div>
                <div class="time-text" id="timerDisplay">25:00</div>
                <button class="btn-circle play" onclick="app.toggleTimer()" id="playBtn">▶</button>
                <button class="btn-circle reset" onclick="app.resetTimer()">↺</button>
            </div>
        </div>

        <!-- SETTINGS -->
        <div id="view-settings" class="view">
            <div class="stat-card">
                <h3 style="margin-top:0">Stats</h3>
                <div style="display:flex; justify-content:space-around;">
                    <div><div class="stat-num" id="sTotal">0</div><div class="stat-lbl">Total</div></div>
                    <div><div class="stat-num" id="sDone">0</div><div class="stat-lbl">Done</div></div>
                </div>
            </div>
            <button class="save-btn" style="background:#ef4444" onclick="app.showConfirm()">Reset All Data</button>
        </div>
    </main>

    <nav>
        <button class="nav-item active" id="n1" onclick="app.nav('tasks', this)">
            <svg class="icon" viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
            Tasks
        </button>
        <button class="nav-item" id="n2" onclick="app.nav('cal', this)">
            <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            Calendar
        </button>
        <button class="nav-item" id="n3" onclick="app.nav('timer', this)">
            <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            Timer
        </button>
        <button class="nav-item" id="n4" onclick="app.nav('settings', this)">
            <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            Settings
        </button>
    </nav>

    <!-- NEW TASK MODAL -->
    <div id="modal">
        <div class="sheet">
            <h2 style="margin-top:0">New Task</h2>
            <input type="text" id="tInput" placeholder="What needs to be done?">
            
            <span class="label">DUE DATE</span>
            <input type="date" id="dInput">
            
            <span class="label">CATEGORY</span>
            <div class="chips" id="catRow"></div>
            
            <div class="opts" style="display:flex; gap:10px; margin-top:20px;">
                <button id="btnStar" onclick="app.togOpt('star')" style="flex:1; padding:10px; border-radius:10px; border:1px solid #ccc; background:white;">★ Star</button>
                <button id="btnFlag" onclick="app.togOpt('flag')" style="flex:1; padding:10px; border-radius:10px; border:1px solid #ccc; background:white;">⚑ Flag</button>
            </div>

            <button class="save-btn" onclick="app.saveTask()">Create Task</button>
            <div style="text-align:center; padding:15px; color:#94a3b8;" onclick="app.closeModal()">Cancel</div>
        </div>
    </div>

    <!-- CONFIRM RESET MODAL (Safe for Android) -->
    <div id="confirmModal">
        <div class="sheet">
            <h2 style="margin-top:0; color:#ef4444;">Warning</h2>
            <p>Are you sure you want to delete all tasks? This cannot be undone.</p>
            <button class="confirm-btn btn-yes" onclick="app.wipe()">Yes, Delete Everything</button>
            <button class="confirm-btn btn-no" onclick="app.hideConfirm()">Cancel</button>
        </div>
    </div>

    <script>
        var app = {
            data: [],
            cats: ['Work', 'Personal', 'Health', 'Shop'],
            temp: { cat:'Personal', star:false, flag:false },
            timer: null,
            time: 1500,
            isRun: false,

            init: function() {
                try {
                    var str = localStorage.getItem('mazi_final_v10');
                    if(str) this.data = JSON.parse(str);
                } catch(e) {}
                
                // Set default date to today
                var today = new Date().toISOString().split('T')[0];
                document.getElementById('dInput').value = today;
                
                this.render();
                this.renderCal();
                this.stats();
            },

            // NAV
            nav: function(v, btn) {
                var views = document.querySelectorAll('.view');
                for(var i=0; i<views.length; i++) views[i].style.display = 'none';
                document.getElementById('view-'+v).style.display = 'block';
                
                var navs = document.querySelectorAll('.nav-item');
                for(var j=0; j<navs.length; j++) navs[j].style.color = '#94a3b8';
                btn.style.color = '#f97316';
            },

            // TASKS
            render: function() {
                var list = document.getElementById('taskList');
                list.innerHTML = '';
                
                if(this.data.length === 0) {
                    list.innerHTML = '<div style="text-align:center; padding-top:60px; color:#cbd5e1; font-weight:bold;">No tasks yet</div>';
                    return;
                }

                for(var i=0; i<this.data.length; i++) {
                    var t = this.data[i];
                    var cls = t.done ? 'task-card done' : 'task-card';
                    
                    var icons = '';
                    if(t.star) icons += '<svg class="icon-sm icon-star" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg> ';
                    if(t.flag) icons += '<svg class="icon-sm icon-flag" viewBox="0 0 24 24"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path><line x1="4" y1="22" x2="4" y2="15"></line></svg>';

                    var html = `
                    <div class="${cls}">
                        <div class="bar ${t.cat}"></div>
                        <div class="checkbox" onclick="app.toggle(${i})">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        </div>
                        <div class="info">
                            <div class="meta">
                                <span style="margin-right:10px">${t.cat}</span>
                                <span>${t.date || ''}</span>
                            </div>
                            <h3>${t.title}</h3>
                            <div class="icons" style="font-size:12px; color:#f59e0b; margin-top:2px;">${icons}</div>
                        </div>
                        <button class="del-btn" onclick="app.del(${i})">✕</button>
                    </div>`;
                    list.innerHTML += html;
                }
                this.stats();
            },

            saveTask: function() {
                var title = document.getElementById('tInput').value;
                var date = document.getElementById('dInput').value;
                if(!title) return; // Silent return, no alert needed

                this.data.unshift({
                    title: title,
                    date: date,
                    cat: this.temp.cat,
                    star: this.temp.star,
                    flag: this.temp.flag,
                    done: false
                });
                this.save();
                this.render();
                this.renderCal();
                this.closeModal();
                
                document.getElementById('tInput').value = '';
                this.nav('tasks', document.getElementById('n1'));
            },

            toggle: function(i) {
                this.data[i].done = !this.data[i].done;
                this.save();
                this.render();
                this.renderCal();
            },

            del: function(i) {
                // Direct delete, no confirm popup to avoid freezing
                this.data.splice(i, 1);
                this.save();
                this.render();
                this.renderCal();
            },

            // CALENDAR
            renderCal: function() {
                var grid = document.getElementById('calGrid');
                grid.innerHTML = '';
                var heads = ['S','M','T','W','T','F','S'];
                for(var h=0; h<7; h++) {
                    grid.innerHTML += `<div class="day-head">${heads[h]}</div>`;
                }

                var now = new Date();
                var today = now.getDate();
                
                for(var i=1; i<=30; i++) {
                    var dayStr = (i<10) ? '0'+i : i;
                    var has = false;
                    for(var t=0; t<this.data.length; t++) {
                        if(this.data[t].date && this.data[t].date.endsWith('-'+dayStr) && !this.data[t].done) has = true;
                    }
                    
                    var cls = 'day';
                    if(i == today) cls += ' today';
                    if(has) cls += ' has-task';
                    
                    grid.innerHTML += `<div class="${cls}">${i}<div class="dot"></div></div>`;
                }
            },

            // TIMER
            toggleTimer: function() {
                var btn = document.getElementById('playBtn');
                if(this.isRun) {
                    clearInterval(this.timer);
                    this.isRun = false;
                    btn.innerText = '▶';
                } else {
                    this.isRun = true;
                    btn.innerText = 'II';
                    this.timer = setInterval(function() {
                        app.time--;
                        if(app.time <= 0) {
                            clearInterval(app.timer);
                            app.isRun = false;
                            app.time = 1500;
                            btn.innerText = '▶';
                        }
                        app.updateTime();
                    }, 1000);
                }
            },
            resetTimer: function() {
                clearInterval(this.timer);
                this.isRun = false;
                this.time = 1500;
                document.getElementById('playBtn').innerText = '▶';
                this.updateTime();
            },
            updateTime: function() {
                var m = Math.floor(this.time / 60);
                var s = this.time 
