<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MaziTM</title>
    
    <!-- LIBRARIES (Loaded from fast CDNs) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- CUSTOM CONFIG -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#f97316', // Orange 500
                        secondary: '#0ea5e9', // Sky 500
                        dark: '#0f172a',
                        surface: '#ffffff',
                        bg: '#f8fafc'
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { -webkit-tap-highlight-color: transparent; background-color: #f8fafc; user-select: none; }
        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* Animations */
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS COMPONENT ---
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { lucide.createIcons(); });
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- APP LOGIC ---
        function App() {
            // DATA STATE
            const [tasks, setTasks] = useState(() => {
                try { return JSON.parse(localStorage.getItem('mazi_pro_v1') || '[]'); } 
                catch { return []; }
            });
            
            // VIEW STATE
            const [view, setView] = useState('tasks'); // tasks, cal, timer, settings
            const [modalOpen, setModalOpen] = useState(false);
            const [filterDate, setFilterDate] = useState(null); // For Calendar filtering

            // FORM STATE
            const [input, setInput] = useState("");
            const [cat, setCat] = useState("Personal");
            const [dueDate, setDueDate] = useState(new Date().toISOString().split('T')[0]);
            const [opts, setOpts] = useState({ star: false, flag: false });

            // TIMER STATE
            const [timeLeft, setTimeLeft] = useState(1500);
            const [timerActive, setTimerActive] = useState(false);

            // SAVE DATA
            useEffect(() => { localStorage.setItem('mazi_pro_v1', JSON.stringify(tasks)); }, [tasks]);
            
            // REFRESH ICONS
            useEffect(() => { lucide.createIcons(); });

            // TIMER LOOP
            useEffect(() => {
                let interval = null;
                if (timerActive && timeLeft > 0) {
                    interval = setInterval(() => setTimeLeft(t => t - 1), 1000);
                } else if (timeLeft === 0) {
                    setTimerActive(false);
                    setTimeLeft(1500);
                    // Simple notification logic could go here
                }
                return () => clearInterval(interval);
            }, [timerActive, timeLeft]);

            // --- HANDLERS ---

            const handleSave = () => {
                if (!input.trim()) return;
                const newTask = {
                    id: Date.now(),
                    title: input,
                    cat,
                    date: dueDate,
                    star: opts.star,
                    flag: opts.flag,
                    completed: false
                };
                setTasks([newTask, ...tasks]);
                setModalOpen(false);
                setInput("");
                // Reset defaults
                setOpts({ star: false, flag: false });
                setCat("Personal");
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
            };

            const deleteTask = (id) => {
                if (confirm("Delete this task?")) {
                    setTasks(tasks.filter(t => t.id !== id));
                }
            };

            const formatTime = (s) => {
                const mins = Math.floor(s / 60);
                const secs = s % 60;
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            };

            // --- SUB-COMPONENTS (RENDERERS) ---

            const Categories = [
                { name: 'Work', bg: 'bg-blue-100', txt: 'text-blue-600' },
                { name: 'Personal', bg: 'bg-orange-100', txt: 'text-orange-600' },
                { name: 'Health', bg: 'bg-rose-100', txt: 'text-rose-600' },
                { name: 'Shop', bg: 'bg-emerald-100', txt: 'text-emerald-600' }
            ];

            const TaskCard = ({ t }) => {
                const c = Categories.find(x => x.name === t.cat) || Categories[1];
                return (
                    <div className={`bg-white p-4 rounded-2xl mb-3 border border-slate-100 shadow-sm flex items-center gap-3 transition-all ${t.completed ? 'opacity-50' : ''}`}>
                        <button onClick={() => toggleTask(t.id)} className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-colors ${t.completed ? 'bg-secondary border-secondary text-white' : 'border-slate-300'}`}>
                            {t.completed && <Icon name="check" size={14} />}
                        </button>
                        <div className="flex-1 overflow-hidden">
                            <div className="flex items-center gap-2 mb-1">
                                <span className={`text-[10px] font-bold uppercase px-2 py-0.5 rounded-md ${c.bg} ${c.txt}`}>{t.cat}</span>
                                {t.star && <Icon name="star" size={12} className="text-amber-400 fill-current" />}
                                {t.flag && <Icon name="flag" size={12} className="text-red-500 fill-current" />}
                            </div>
                            <h3 className={`font-semibold text-sm truncate ${t.completed ? 'line-through text-slate-400' : 'text-slate-800'}`}>{t.title}</h3>
                            <p className="text-[10px] text-slate-400 font-medium mt-0.5">{t.date}</p>
                        </div>
                        <button onClick={() => deleteTask(t.id)} className="p-2 text-slate-300 hover:text-red-500">
                            <Icon name="trash-2" size={18} />
                        </button>
                    </div>
                );
            };

            const CalendarView = () => {
                // Generate simple grid for current month
                const days = Array.from({ length: 30 }, (_, i) => {
                    const d = new Date();
                    d.setDate(new Date().getDate() + (i - new Date().getDate() + 1)); // Just a simple 1-30 logic for demo
                    // Better logic: get true days of month. Let's just do next 14 days for UI clarity
                    const dateObj = new Date();
                    dateObj.setDate(dateObj.getDate() + i - 3); // Start a few days back
                    return dateObj.toISOString().split('T')[0]; 
                });

                return (
                    <div className="space-y-4">
                        <div className="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm">
                            <h2 className="font-bold text-lg mb-4 text-slate-800">Schedule</h2>
                            <div className="flex overflow-x-auto gap-3 pb-2 no-scrollbar">
                                {days.map((dateStr, idx) => {
                                    const dateObj = new Date(dateStr);
                                    const dayNum = dateObj.getDate();
                                    const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'short' });
                                    const isSelected = filterDate === dateStr;
                                    const hasTask = tasks.some(t => t.date === dateStr && !t.completed);
                                    
                                    return (
                                        <button key={idx} onClick={() => setFilterDate(isSelected ? null : dateStr)} 
                                            className={`flex-shrink-0 w-14 h-16 rounded-xl flex flex-col items-center justify-center border-2 transition-all ${isSelected ? 'bg-primary border-primary text-white shadow-lg' : 'bg-white border-slate-100 text-slate-500'}`}>
                                            <span className="text-[10px] font-bold uppercase">{dayName}</span>
                                            <span className="text-lg font-black">{dayNum}</span>
                                            {hasTask && <div className={`w-1.5 h-1.5 rounded-full mt-1 ${isSelected ? 'bg-white' : 'bg-secondary'}`}></div>}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                        
                        <div>
                            <h3 className="font-bold text-slate-400 text-xs uppercase mb-3 px-1">
                                {filterDate ? `Tasks for ${filterDate}` : 'All Upcoming Tasks'}
                            </h3>
                            {tasks
                                .filter(t => filterDate ? t.date === filterDate : true)
                                .map(t => <TaskCard key={t.id} t={t} />)
                            }
                            {tasks.filter(t => filterDate ? t.date === filterDate : true).length === 0 && (
                                <div className="text-center py-10 text-slate-300 text-sm font-medium">No tasks for this day</div>
                            )}
                        </div>
                    </div>
                );
            };

            // --- MAIN RENDER ---
            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    
                    {/* Header */}
                    <header className="h-16 bg-white border-b border-slate-100 flex items-center justify-between px-5 fixed top-0 w-full z-20">
                        <div className="flex items-center gap-2">
                            <div className="w-9 h-9 bg-gradient-to-br from-primary to-orange-600 rounded-xl flex items-center justify-center text-white font-black text-xl shadow-lg shadow-orange-500/20">M</div>
                            <h1 className="text-xl font-bold text-slate-800 tracking-tight">Mazi<span className="text-secondary font-light">TM</span></h1>
                        </div>
                        <button onClick={() => setModalOpen(true)} className="w-10 h-10 bg-dark rounded-full flex items-center justify-center text-white shadow-xl active:scale-95 transition-transform">
                            <Icon name="plus" />
                        </button>
                    </header>

                    {/* Content */}
                    <main className="flex-1 pt-20 pb-24 px-4 overflow-y-auto">
                        
                        {view === 'tasks' && (
                            <>
                                <div className="flex items-center justify-between mb-4 px-1">
                                    <h2 className="text-xl font-bold text-slate-800">My Tasks</h2>
                                    <span className="bg-slate-100 text-slate-500 text-xs font-bold px-2 py-1 rounded-lg">{tasks.filter(t=>!t.completed).length} Pending</span>
                                </div>
                                {tasks.length === 0 ? (
                                    <div className="flex flex-col items-center justify-center pt-20 opacity-40">
                                        <Icon name="clipboard-list" size={48} className="mb-2 text-slate-400"/>
                                        <p className="font-bold text-slate-400">Your list is empty</p>
                                    </div>
                                ) : (
                                    tasks.sort((a,b) => Number(a.completed)-Number(b.completed)).map(t => <TaskCard key={t.id} t={t} />)
                                )}
                            </>
                        )}

                        {view === 'cal' && <CalendarView />}

                        {view === 'timer' && (
                            <div className="h-full flex flex-col items-center justify-center -mt-10">
                                <div className="text-xs font-bold tracking-widest text-slate-400 mb-8">FOCUS TIMER</div>
                                <div className="relative mb-10">
                                    <svg className="w-64 h-64 transform -rotate-90">
                                        <circle cx="128" cy="128" r="120" stroke="currentColor" strokeWidth="8" fill="transparent" className="text-slate-100" />
                                        <circle cx="128" cy="128" r="120" stroke="currentColor" strokeWidth="8" fill="transparent" strokeDasharray={2 * Math.PI * 120} strokeDashoffset={2 * Math.PI * 120 * (1 - timeLeft/1500)} className="text-primary transition-all duration-1000 ease-linear" strokeLinecap="round" />
                                    </svg>
                                    <div className="absolute inset-0 flex items-center justify-center text-6xl font-black text-slate-800 font-mono tracking-tighter">
                                        {formatTime(timeLeft)}
                                    </div>
                                </div>
                                <div className="flex gap-6">
                                    <button onClick={() => setTimerActive(!timerActive)} className="w-20 h-20 bg-dark rounded-full text-white flex items-center justify-center shadow-2xl active:scale-95 transition-transform">
                                        <Icon name={timerActive ? "pause" : "play"} size={32} fill="currentColor" />
                                    </button>
                                    <button onClick={() => {setTimerActive(false); setTimeLeft(1500)}} className="w-14 h-14 bg-slate-200 rounded-full text-slate-600 flex items-center justify-center active:scale-95 transition-transform">
                                        <Icon name="rotate-ccw" />
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === 'settings' && (
                            <div className="space-y-6">
                                <div className="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                                    <h3 className="font-bold text-lg mb-4 text-slate-800">Overview</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-slate-50 p-4 rounded-2xl text-center">
                                            <div className="text-3xl font-black text-primary">{tasks.length}</div>
                                            <div className="text-[10px] font-bold uppercase text-slate-400">Total Tasks</div>
                                        </div>
                                        <div className="bg-slate-50 p-4 rounded-2xl text-center">
                                            <div className="text-3xl font-black text-emerald-500">{tasks.filter(t=>t.completed).length}</div>
                                            <div className="text-[10px] font-bold uppercase text-slate-400">Completed</div>
                                        </div>
                                    </div>
                                </div>
                                <button onClick={() => {if(confirm("Reset all data?")) setTasks([])}} className="w-full py-4 bg-red-50 text-red-500 font-bold rounded-2xl border border-red-100">
                                    Delete All Data
                                </button>
                                <div className="text-center text-xs font-bold text-slate-300 mt-4">MaziTM Pro v1.0</div>
                            </div>
                        )}

                    </main>

                    {/* Bottom Nav */}
                    <nav className="h-16 bg-white border-t border-slate-100 fixed bottom-0 w-full flex justify-around items-center z-40 pb-safe">
                        {[
                            { id: 'tasks', icon: 'check-square', label: 'Tasks' },
                            { id: 'cal', icon: 'calendar', label: 'Calendar' },
                            { id: 'timer', icon: 'timer', label: 'Timer' },
                            { id: 'settings', icon: 'settings', label: 'Settings' },
                        ].map(item => (
                            <button key={item.id} onClick={() => setView(item.id)} className={`flex flex-col items-center gap-1 transition-colors ${view === item.id ? 'text-primary' : 'text-slate-400'}`}>
                                <Icon name={item.icon} size={22} strokeWidth={view === item.id ? 2.5 : 2} />
                                <span className="text-[10px] font-bold">{item.label}</span>
                            </button>
                        ))}
                    </nav>

                    {/* Add Task Modal */}
                    {modalOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 z-50 flex items-end justify-center backdrop-blur-sm p-4 animate-fade-in">
                            <div className="bg-white w-full max-w-md rounded-3xl p-6 animate-slide-up shadow-2xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold text-slate-800">New Task</h2>
                                    <button onClick={() => setModalOpen(false)} className="bg-slate-100 p-2 rounded-full text-slate-500"><Icon name="x" size={20} /></button>
                                </div>

                                <div className="space-y-5">
                                    {/* Title Input */}
                                    <input autoFocus value={input} onChange={e => setInput(e.target.value)} placeholder="What do you want to do?" className="w-full text-lg border-b-2 border-slate-100 py-3 outline-none focus:border-primary bg-transparent font-medium" />

                                    {/* Date Picker (Native) */}
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 block">Due Date</label>
                                        <input type="date" value={dueDate} onChange={e => setDueDate(e.target.value)} className="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 font-bold text-slate-700 outline-none focus:ring-2 focus:ring-primary/20" />
                                    </div>

                                    {/* Categories */}
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 block">Category</label>
                                        <div className="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                                            {Categories.map(c => (
                                                <button key={c.name} onClick={() => setCat(c.name)} className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all whitespace-nowrap ${cat === c.name ? 'bg-dark text-white border-dark' : 'bg-white text-slate-500 border-slate-200'}`}>
                                                    {c.name}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Toggles */}
                                    <div className="flex gap-3">
                                        <button onClick={() => setOpts({ ...opts, star: !opts.star })} className={`flex-1 py-3 rounded-xl border flex items-center justify-center gap-2 font-bold transition-colors ${opts.star ? 'bg-amber-50 border-amber-200 text-amber-600' : 'border-slate-200 text-slate-400'}`}>
                                            <Icon name="star" size={18} className={opts.star ? "fill-current" : ""} /> Star
                                        </button>
                                        <button onClick={() => setOpts({ ...opts, flag: !opts.flag })} className={`flex-1 py-3 rounded-xl border flex items-center justify-center gap-2 font-bold transition-colors ${opts.flag ? 'bg-red-50 border-red-200 text-red-600' : 'border-slate-200 text-slate-400'}`}>
                                            <Icon name="flag" size={18} className={opts.flag ? "fill-current" : ""} /> Flag
                                        </button>
                                    </div>

                                    <button onClick={handleSave} className="w-full bg-primary hover:bg-orange-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-orange-500/30 active:scale-95 transition-transform">
                                        Create Task
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
