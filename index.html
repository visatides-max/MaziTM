<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MaziTM</title>
    <style>
        /* CSS STYLES */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body {
            margin: 0; padding: 0;
            font-family: sans-serif;
            background-color: #f8fafc; color: #1e293b;
            height: 100vh; display: flex; flex-direction: column;
            user-select: none;
        }

        /* HEADER */
        header {
            height: 60px; background: white; border-bottom: 1px solid #e2e8f0;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; position: fixed; top: 0; width: 100%; z-index: 100;
        }
        .logo {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, #fb923c, #ea580c);
            border-radius: 8px; color: white; font-weight: bold; font-size: 18px;
            display: flex; align-items: center; justify-content: center;
        }
        .brand { font-size: 20px; font-weight: 800; margin-left: 10px; }
        .brand span { color: #38bdf8; }
        .add-btn {
            width: 40px; height: 40px; background: #0f172a; color: white;
            border-radius: 50%; border: none; font-size: 24px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* MAIN */
        main { flex: 1; padding: 75px 15px 80px 15px; overflow-y: auto; }
        .view { display: none; }
        .view.active { display: block; }

        /* TASKS */
        .task-card {
            background: white; padding: 15px; border-radius: 12px;
            margin-bottom: 10px; display: flex; align-items: center;
            border: 1px solid #e2e8f0; position: relative; overflow: hidden;
        }
        .bar { position: absolute; left: 0; top: 0; bottom: 0; width: 5px; background: #ccc; }
        .task-card.Work .bar { background: #3b82f6; }
        .task-card.Personal .bar { background: #f97316; }
        .task-card.Health .bar { background: #ef4444; }
        
        .checkbox {
            width: 24px; height: 24px; border: 2px solid #cbd5e1; border-radius: 6px;
            display: flex; align-items: center; justify-content: center; margin-left: 10px;
        }
        .task-card.done .checkbox { background: #38bdf8; border-color: #38bdf8; }
        .checkbox span { display: none; color: white; font-size: 14px; }
        .task-card.done .checkbox span { display: block; }
        .task-card.done h3 { text-decoration: line-through; color: #94a3b8; }
        .task-card.done { opacity: 0.6; }

        .info { flex: 1; margin-left: 12px; }
        .meta { font-size: 10px; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-bottom: 2px; }
        h3 { margin: 0; font-size: 16px; font-weight: 600; }
        .icons { font-size: 14px; margin-top: 2px; }
        
        .del-btn { padding: 10px; color: #cbd5e1; font-weight: bold; font-size: 18px; }

        /* CALENDAR */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .cal-day {
            aspect-ratio: 1; background: white; border: 1px solid #e2e8f0; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold;
        }
        .cal-day.today { background: #fb923c; color: white; border-color: #fb923c; }
        .dot { width: 4px; height: 4px; background: #38bdf8; border-radius: 50%; margin-top: 2px; display: none; }
        .cal-day.has-task .dot { display: block; }
        .cal-day.today .dot { background: white; }

        /* TIMER */
        .timer-box { text-align: center; padding-top: 40px; }
        .time-disp { font-size: 60px; font-weight: 900; color: #1e293b; margin: 30px 0; }
        .play-btn { width: 70px; height: 70px; border-radius: 50%; background: #fb923c; color: white; border: none; font-size: 24px; }
        .reset-btn { width: 50px; height: 50px; border-radius: 50%; background: #e2e8f0; color: #64748b; border: none; font-size: 20px; margin-left: 15px; }

        /* NAV */
        nav {
            position: fixed; bottom: 0; width: 100%; height: 60px; background: white;
            border-top: 1px solid #e2e8f0; display: flex; justify-content: space-around; align-items: center; z-index: 50;
        }
        .nav-item { border: none; background: none; color: #94a3b8; font-size: 10px; font-weight: bold; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: #fb923c; }
        .nav-icon { font-size: 20px; margin-bottom: 2px; }

        /* MODAL */
        #modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 100; display: none; align-items: flex-end;
        }
        .sheet { background: white; width: 100%; padding: 20px; border-radius: 20px 20px 0 0; }
        .lbl { font-size: 10px; font-weight: bold; color: #94a3b8; margin: 15px 0 5px 0; display: block; }
        input { width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 8px; }
        
        .chips { display: flex; gap: 8px; margin-bottom: 10px; overflow-x: auto; }
        .chip { padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 15px; font-size: 12px; font-weight: bold; white-space: nowrap; }
        .chip.selected { background: #fb923c; color: white; border-color: #fb923c; }
        
        .opts { display: flex; gap: 10px; margin-top: 15px; margin-bottom: 20px; }
        .opt { flex: 1; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; text-align: center; font-weight: bold; font-size: 12px; }
        .opt.active { background: #e0f2fe; color: #0284c7; border-color: #38bdf8; }
        
        .save-btn { width: 100%; padding: 15px; background: #0f172a; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; }
        
        /* Stats */
        .stat-box { background: white; padding: 20px; border-radius: 15px; border: 1px solid #e2e8f0; text-align: center; margin-bottom: 20px; }
        .stat-val { font-size: 30px; font-weight: 900; color: #fb923c; }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; align-items:center;">
            <div class="logo">M</div>
            <div class="brand">Mazi<span>TM</span></div>
        </div>
        <button class="add-btn" onclick="openModal()">+</button>
    </header>

    <main>
        <!-- Tasks -->
        <div id="v-tasks" class="view active">
            <div id="taskList"></div>
        </div>

        <!-- Calendar -->
        <div id="v-cal" class="view">
            <h2 style="margin-top:0">This Month</h2>
            <div class="cal-grid" id="calGrid"></div>
        </div>

        <!-- Timer -->
        <div id="v-timer" class="view">
            <div class="timer-box">
                <div style="font-size:12px; font-weight:bold; color:#94a3b8;">FOCUS TIMER</div>
                <div class="time-disp" id="timerDisp">25:00</div>
                <button class="play-btn" onclick="toggleTimer()" id="playBtn">‚ñ∂</button>
                <button class="reset-btn" onclick="resetTimer()">‚Ü∫</button>
            </div>
        </div>

        <!-- Settings -->
        <div id="v-settings" class="view">
            <div class="stat-box">
                <div style="display:flex; justify-content:space-around;">
                    <div><div class="stat-val" id="sTotal">0</div><div style="font-size:10px; font-weight:bold; color:#94a3b8">TOTAL</div></div>
                    <div><div class="stat-val" id="sDone">0</div><div style="font-size:10px; font-weight:bold; color:#94a3b8">DONE</div></div>
                </div>
            </div>
            <button class="save-btn" style="background:#ef4444" onclick="wipeData()">Reset Data</button>
        </div>
    </main>

    <nav>
        <button class="nav-item active" id="n1" onclick="nav('tasks', this)"><div class="nav-icon">‚òë</div>Tasks</button>
        <button class="nav-item" id="n2" onclick="nav('cal', this)"><div class="nav-icon">üìÖ</div>Cal</button>
        <button class="nav-item" id="n3" onclick="nav('timer', this)"><div class="nav-icon">‚è±</div>Timer</button>
        <button class="nav-item" id="n4" onclick="nav('settings', this)"><div class="nav-icon">‚öô</div>Set</button>
    </nav>

    <!-- Modal -->
    <div id="modal">
        <div class="sheet">
            <h2 style="margin-top:0">New Task</h2>
            <input type="text" id="tInput" placeholder="Task Name">
            
            <span class="lbl">DUE DATE (Day of Month)</span>
            <div class="chips" id="dateRow"></div>
            
            <span class="lbl">CATEGORY</span>
            <div class="chips" id="catRow"></div>
            
            <div class="opts">
                <div class="opt" id="btnStar" onclick="togOpt('star')">‚òÖ Star</div>
                <div class="opt" id="btnFlag" onclick="togOpt('flag')">‚öë Flag</div>
            </div>

            <button class="save-btn" onclick="saveTask()">Save Task</button>
            <div style="text-align:center; padding:15px; color:#94a3b8;" onclick="closeModal()">Cancel</div>
        </div>
    </div>

    <script>
        /* --- GLOBAL VARIABLES --- */
        var tasks = [];
        var cats = ['Work', 'Personal', 'Health'];
        var temp = { cat:'Personal', star:false, flag:false, date:1 };
        var timerId = null;
        var timeLeft = 1500;
        var isRun = false;

        /* --- STARTUP --- */
        // Try to load, but don't crash if it fails
        try {
            var str = localStorage.getItem('mazi_final_v6');
            if(str) tasks = JSON.parse(str);
        } catch(e) {
            console.log("Storage error");
        }

        // Set default date
        temp.date = new Date().getDate();
        
        // Initial Render
        renderTasks();
        renderCal();
        updateStats();

        /* --- NAVIGATION --- */
        function nav(name, btn) {
            var views = document.querySelectorAll('.view');
            for(var i=0; i<views.length; i++) views[i].style.display = 'none';
            document.getElementById('view-'+name).style.display = 'block';
            
            var navs = document.querySelectorAll('.nav-item');
            for(var j=0; j<navs.length; j++) navs[j].style.color = '#94a3b8';
            btn.style.color = '#fb923c';
        }

        /* --- TASKS --- */
        function renderTasks() {
            var list = document.getElementById('taskList');
            list.innerHTML = '';
            
            if(tasks.length === 0) {
                list.innerHTML = '<div style="text-align:center; margin-top:50px; color:#ccc;">No tasks yet</div>';
                return;
            }

            for(var i=0; i<tasks.length; i++) {
                var t = tasks[i];
                var cls = t.done ? 'task-card '+t.cat+' done' : 'task-card '+t.cat;
                var iconHtml = '';
                if(t.star) iconHtml += '<span style="color:#fbbf24">‚òÖ</span> ';
                if(t.flag) iconHtml += '<span style="color:#ef4444">‚öë</span>';
                var checkHtml = t.done ? '<span>‚úî</span>' : '';

                var html = '<div class="'+cls+'">' +
                    '<div class="bar"></div>' +
                    '<div class="checkbox" onclick="togTask('+i+')">'+checkHtml+'</div>' +
                    '<div class="info">' +
                        '<div class="meta">'+t.cat+' ‚Ä¢ Day '+t.date+'</div>' +
                        '<h3>'+t.title+'</h3>' +
                        '<div class="icons">'+iconHtml+'</div>' +
                    '</div>' +
                    '<div class="del-btn" onclick="delTask('+i+')">‚úï</div>' +
                '</div>';
                list.innerHTML += html;
            }
            updateStats();
        }

        function togTask(i) {
            tasks[i].done = !tasks[i].done;
            save();
            renderTasks();
            renderCal();
        }

        function delTask(i) {
            tasks.splice(i, 1); // Removed confirm() to prevent freezing
            save();
            renderTasks();
            renderCal();
        }

        function saveTask() {
            var inp = document.getElementById('tInput');
            if(!inp.value) return;

            tasks.unshift({
                title: inp.value,
                cat: temp.cat,
                star: temp.star,
                flag: temp.flag,
                date: temp.date,
                done: false
            });

            save();
            renderTasks();
            renderCal();
            closeModal();
            inp.value = '';
            
            // Go to tasks view
            nav('tasks', document.getElementById('n1'));
        }

        /* --- CALENDAR --- */
        function renderCal() {
            var grid = document.getElementById('calGrid');
            grid.innerHTML = '';
            
            // Headers
            var heads = ['S','M','T','W','T','F','S'];
            for(var h=0; h<7; h++) {
                grid.innerHTML += '<div style="font-size:10px; font-weight:bold; color:#ccc;">'+heads[h]+'</div>';
            }

            var today = new Date().getDate();

            for(var i=1; i<=30; i++) {
                var has = false;
                for(var t=0; t<tasks.length; t++) {
                    if(tasks[t].date == i && !tasks[t].done) has = true;
                }
                var cls = (i == today) ? 'cal-day today' : 'cal-day';
                if(has) cls += ' has-task';
                var dotHtml = '<div class="dot"></div>';
                grid.innerHTML += '<div class="'+cls+'">' + i + dotHtml + '</div>';
            }
        }

        /* --- TIMER --- */
        function toggleTimer() {
            var btn = document.getElementById('playBtn');
            if(isRun) {
                clearInterval(timerId);
                isRun = false;
                btn.innerText = '‚ñ∂';
            } else {
                isRun = true;
                btn.innerText = 'II';
                timerId = setInterval(function() {
                    timeLeft--;
                    if(timeLeft <= 0) {
                        clearInterval(timerId);
                        isRun = false;
                        timeLeft = 1500;
                        btn.innerText = '‚ñ∂';
                    }
                    var m = Math.floor(timeLeft / 60);
                    var s = timeLeft % 60;
                    if(s<10) s = '0'+s;
                    document.getElementById('timerDisp').innerText = m + ':' + s;
                }, 1000);
            }
        }

        function resetTimer() {
            clearInterval(timerId);
            isRun = false;
            timeLeft = 1500;
            document.getElementById('playBtn').innerText = '‚ñ∂';
            document.getElementById('timerDisp').innerText = '25:00';
        }

        /* --- MODAL --- */
        function openModal() {
            document.getElementById('modal').style.display = 'flex';
            temp = { cat:'Personal', star:false, flag:false, date: new Date().getDate() };
            
            // Render Cats
            var cRow = document.getElementById('catRow');
            cRow.innerHTML = '';
            for(var i=0; i<cats.length; i++) {
                var c = cats[i];
                var cls = (temp.cat == c) ? 'chip selected' : 'chip';
                cRow.innerHTML += '<div class="'+cls+'" onclick="setCat(\''+c+'\')">'+c+'</div>';
            }

            // Render Dates (Horizontal Scroll)
            var dRow = document.getElementById('dateRow');
            dRow.innerHTML = '';
            for(var j=1; j<=30; j++) {
                var cls = (temp.date == j) ? 'chip selected' : 'chip';
                dRow.innerHTML += '<div class="'+cls+'" onclick="setDate('+j+')">'+j+'</div>';
            }
            
            updateOpts();
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        
        function setCat(c) { temp.cat = c; openModal(); } // Re-render simple way
        function setDate(d) { temp.date = d; openModal(); }
        function togOpt(k) { temp[k] = !temp[k]; updateOpts(); }
        
        function updateOpts() {
            var s = document.getElementById('btnStar');
            var f = document.getElementById('btnFlag');
            s.className = temp.star ? 'opt active' : 'opt';
            f.className = temp.flag ? 'opt active' : 'opt';
        }

        /* --- STATS --- */
        function updateStats() {
            document.getElementById('sTotal').innerText = tasks.length;
            var d = 0;
            for(var i=0; i<tasks.length; i++) if(tasks[i].done) d++;
            document.getElementById('sDone').innerText = d;
        }

        function wipeData() {
            tasks = [];
            save();
            renderTasks();
            renderCal();
            updateStats();
        }

        function save() {
            try {
                localStorage.setItem('mazi_final_v6', JSON.stringify(tasks));
            } catch(e) {}
        }
    </script>
</body>
</html>
